services:
  - type: web
    name: n8n
    env: docker
    plan: free
    branch: main
    healthCheckPath: /rest/healthz
    envVars:
      # --- Authentication (REQUIRED - Set these in Render Dashboard) ---
      - key: N8N_BASIC_AUTH_ACTIVE
        value: true
      - key: N8N_BASIC_AUTH_USER
        value: admin  # ⚠️ CHANGE THIS to your desired username
      - key: N8N_BASIC_AUTH_PASSWORD
        sync: false  # ⚠️ MUST be set manually in Render Dashboard as a Secret!
      
      # --- Server Configuration ---
      - key: N8N_PORT
        value: 5678
      - key: N8N_PROTOCOL
        value: https
      - key: N8N_LISTEN_ADDRESS
        value: 0.0.0.0
      - key: N8N_HOST
        sync: false  # ⚠️ Will be auto-generated by Render (e.g., n8n-xxxxx.onrender.com)
      - key: WEBHOOK_URL
        sync: false  # ⚠️ Set this to https://YOUR-SERVICE-NAME.onrender.com/ after deployment
      
      # --- Timezone ---
      - key: GENERIC_TIMEZONE
        value: Asia/Manila  # ⚠️ Change to your timezone if needed
      
      # --- Neon PostgreSQL Database Configuration (REQUIRED) ---
      # Get these values from your Neon dashboard: https://console.neon.tech
      - key: DB_TYPE
        value: postgresdb
      - key: DB_POSTGRESDB_HOST
        sync: false  # ⚠️ Set to your Neon host (e.g., ep-xxxxx.ap-southeast-1.aws.neon.tech)
      - key: DB_POSTGRESDB_PORT
        value: 5432
      - key: DB_POSTGRESDB_DATABASE
        sync: false  # ⚠️ Set to your Neon database name (e.g., neondb)
      - key: DB_POSTGRESDB_USER
        sync: false  # ⚠️ Set to your Neon username (e.g., neondb_owner)
      - key: DB_POSTGRESDB_PASSWORD
        sync: false  # ⚠️ MUST be set manually in Render Dashboard as a Secret!
      - key: DB_POSTGRESDB_SSLMODE
        value: require  # Neon requires SSL
      
      # --- Logging & Performance ---
      - key: N8N_LOG_LEVEL
        value: debug  # Change to 'info' or 'error' for production
      - key: NODE_OPTIONS
        value: --dns-result-order=ipv4first  # Fixes DNS resolution issues on Render
      
      # --- Security (RECOMMENDED) ---
      # Uncomment and set manually in Render Dashboard as a Secret:
      # - key: N8N_ENCRYPTION_KEY
      #   sync: false  # Generate with: openssl rand -hex 16 (32 characters total)
